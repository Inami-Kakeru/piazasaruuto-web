# ğŸ—ï¸ **ã´ã‚ã–ã•ã‚‹ã†ã¨äºˆç´„ã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸**

## ğŸ“‹ **ç›®æ¬¡**
1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ](#5-ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ)
6. [APIè¨­è¨ˆ](#6-apiè¨­è¨ˆ)
7. [çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#7-çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
8. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#8-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
9. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#9-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
10. [é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ](#10-é–‹ç™ºãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ)
11. [ç›£è¦–ãƒ»ãƒ­ã‚°](#11-ç›£è¦–ãƒ­ã‚°)
12. [ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»](#12-ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ å
**ã´ã‚ã–ã•ã‚‹ã†ã¨äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ** (Piazasaruuto Booking System)

### 1.2 ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç°¡å˜ã«äºˆç´„ã‚’ä½œæˆãƒ»ç®¡ç†ã§ãã‚‹
- ç®¡ç†è€…ãŒäºˆç´„çŠ¶æ³ã‚’ä¸€å…ƒç®¡ç†ã§ãã‚‹
- Cal.comã¨ã®é€£æºã«ã‚ˆã‚‹é«˜åº¦ãªäºˆç´„æ©Ÿèƒ½ã®æä¾›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®äºˆç´„çŠ¶æ³ã®å¯è¦–åŒ–

### 1.3 ä¸»è¦æ©Ÿèƒ½
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»èªå¯
- äºˆç´„ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- äºˆç´„çŠ¶æ³ã®ç¢ºèª
- é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- Cal.comé€£æº

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 2.1 å…¨ä½“æ§‹æˆå›³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             çµ±åˆäºˆç´„ã‚·ã‚¹ãƒ†ãƒ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   cal.com       â”‚    â”‚  booking-system â”‚    â”‚   Supabase      â”‚        â”‚
â”‚  â”‚   (ãƒãƒ¼ãƒˆ3000)   â”‚â—„â”€â”€â–ºâ”‚   (ãƒãƒ¼ãƒˆ3001)   â”‚â—„â”€â”€â–ºâ”‚   (PostgreSQL)  â”‚        â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚        â”‚
â”‚  â”‚ â€¢ æ±ç”¨äºˆç´„      â”‚    â”‚ â€¢ ç¾å®¹é™¢ç‰¹åŒ–    â”‚    â”‚ â€¢ å…±é€šDB        â”‚        â”‚
â”‚  â”‚ â€¢ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºâ”‚    â”‚ â€¢ ç®¡ç†ç”»é¢      â”‚    â”‚ â€¢ èªè¨¼          â”‚        â”‚
â”‚  â”‚ â€¢ å¤–éƒ¨API       â”‚    â”‚ â€¢ ã‚·ãƒ³ãƒ—ãƒ«UI    â”‚    â”‚ â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                       â”‚                       â”‚                â”‚
â”‚           â”‚                       â”‚                       â”‚                â”‚
â”‚           â–¼                       â–¼                       â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Redis Cache   â”‚    â”‚   MCP Server    â”‚    â”‚   File Storage  â”‚        â”‚
â”‚  â”‚   (ã‚»ãƒƒã‚·ãƒ§ãƒ³)   â”‚    â”‚   (Python)      â”‚    â”‚   (ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«)â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ
1. **ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤** (Frontend)
2. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤** (Backend API)
3. **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤** (Database)
4. **å¤–éƒ¨é€£æºå±¤** (Cal.com, MCP)

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°

### 3.1 cal.comï¼ˆæ±ç”¨äºˆç´„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 14 (App Router)
- **è¨€èª**: TypeScript
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase PostgreSQL
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker

#### ä¸»è¦æ©Ÿèƒ½
```typescript
interface CalComFeatures {
  // äºˆç´„ç®¡ç†
  booking: {
    create: (event: CalEvent) => Promise<void>
    update: (id: string, event: CalEvent) => Promise<void>
    delete: (id: string) => Promise<void>
  }
  
  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº
  calendar: {
    google: boolean
    outlook: boolean
    ical: boolean
  }
  
  // ãƒãƒ¼ãƒ ç®¡ç†
  team: {
    members: User[]
    permissions: Permission[]
    scheduling: TeamScheduling
  }
  
  // æ”¯æ‰•ã„é€£æº
  payment: {
    stripe: boolean
    paypal: boolean
    custom: boolean
  }
}
```

#### Dockerè¨­å®š
```yaml
# docker-compose.yml
services:
  calcom:
    image: calcom/cal.com:latest
    ports: ["3000:3000"]
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      - CALENDSO_ENCRYPTION_KEY=${CALENDSO_ENCRYPTION_KEY}
    depends_on: [redis]
    
  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
```

### 3.2 booking-systemï¼ˆç¾å®¹é™¢ç‰¹åŒ–ã‚·ã‚¹ãƒ†ãƒ ï¼‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 15 (App Router)
- **è¨€èª**: TypeScript
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase PostgreSQL + Prisma ORM
- **çŠ¶æ…‹ç®¡ç†**: Zustand
- **UI**: Tailwind CSS + shadcn/ui

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢ä¿‚å›³
```prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings      Booking[]
  notifications Notification[]

  @@map("users")
}

model Staff {
  id       String    @id @default(cuid())
  name     String
  email    String?   @unique
  phone    String?
  isActive Boolean   @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]

  @@map("staff")
}

model Service {
  id          String   @id @default(cuid())
  name        String   @unique  // ç¾å®¹é™¢ã‚µãƒ¼ãƒ“ã‚¹å
  description String?
  minutes     Int      // æ–½è¡“æ™‚é–“
  price       Int?     // ä¾¡æ ¼
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bookings Booking[]

  @@map("services")
}

model Booking {
  id            String        @id @default(cuid())
  userId        String?       // é¡§å®¢ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³å¯¾å¿œï¼‰
  staffId       String        // ã‚¹ã‚¿ãƒƒãƒ•
  serviceId     String        // ã‚µãƒ¼ãƒ“ã‚¹
  title         String        // äºˆç´„ã‚¿ã‚¤ãƒˆãƒ«
  startTime     DateTime      // é–‹å§‹æ™‚é–“
  endTime       DateTime      // çµ‚äº†æ™‚é–“
  status        BookingStatus @default(PENDING)
  calEventId    String?       // Cal.comé€£æºç”¨
  customerName  String?       // é¡§å®¢å
  customerPhone String?       // é›»è©±ç•ªå·
  customerEmail String?       // ãƒ¡ãƒ¼ãƒ«
  
  user    User?    @relation(fields: [userId], references: [id])
  staff   Staff    @relation(fields: [staffId], references: [id])
  service Service  @relation(fields: [serviceId], references: [id])

  @@map("bookings")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  bookingId String
  type      NotificationType
  message   String
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

enum UserRole {
  USER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum NotificationType {
  EMAIL
  PUSH
}
```

### 4.2 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ
```sql
-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_bookings_staff_time ON bookings(staff_id, start_time);
CREATE INDEX idx_bookings_service_time ON bookings(service_id, start_time);
CREATE INDEX idx_bookings_status_time ON bookings(status, start_time);
CREATE INDEX idx_bookings_cal_event_id ON bookings(cal_event_id);

-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰
CREATE TABLE bookings_2024 PARTITION OF bookings
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

---

## 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### 5.1 ãƒšãƒ¼ã‚¸æ§‹æˆ
```
src/app/
â”œâ”€â”€ page.tsx              // ãƒ›ãƒ¼ãƒ ï¼ˆäºˆç´„ä½œæˆãƒ»ä¸€è¦§ï¼‰
â”œâ”€â”€ login/                // ãƒ­ã‚°ã‚¤ãƒ³
â”œâ”€â”€ admin/                // ç®¡ç†è€…ç”»é¢
â””â”€â”€ api/                  // API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ bookings/         // äºˆç´„ç®¡ç†
    â”œâ”€â”€ staff/            // ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†
    â””â”€â”€ services/         // ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†
```

### 5.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
src/components/
â”œâ”€â”€ ui/                   // åŸºæœ¬UIï¼ˆButton, Inputç­‰ï¼‰
â”œâ”€â”€ booking/              // äºˆç´„é–¢é€£
â”‚   â”œâ”€â”€ BookingForm.tsx   // äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”œâ”€â”€ BookingList.tsx   // äºˆç´„ä¸€è¦§
â”‚   â”œâ”€â”€ Selects.tsx       // é¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ TimeSlots.tsx     // æ™‚é–“æ é¸æŠ
â””â”€â”€ admin/                // ç®¡ç†è€…ç”¨
```

### 5.3 çŠ¶æ…‹ç®¡ç†ï¼ˆZustandï¼‰
```typescript
interface BookingState {
  user: User | null
  bookings: Booking[]
  loading: boolean
  error: string | null
  
  // Actions
  fetchBookings: () => Promise<void>
  createBooking: (booking: CreateBooking) => Promise<void>
  updateBooking: (id: string, updates: Partial<Booking>) => Promise<void>
  deleteBooking: (id: string) => Promise<void>
  
  // Auth
  login: (email: string, password: string) => Promise<void>
  logout: () => Promise<void>
}

export const useBookingStore = create<BookingState>((set, get) => ({
  // å®Ÿè£…...
}))
```

---

## 6. APIè¨­è¨ˆ

### 6.1 RESTful API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### èªè¨¼é–¢é€£
```
POST   /api/auth/login
POST   /api/auth/logout
POST   /api/auth/register
GET    /api/auth/me
```

#### äºˆç´„é–¢é€£
```
GET    /api/bookings              # äºˆç´„ä¸€è¦§å–å¾—
POST   /api/bookings              # äºˆç´„ä½œæˆ
GET    /api/bookings/:id          # äºˆç´„è©³ç´°å–å¾—
PUT    /api/bookings/:id          # äºˆç´„æ›´æ–°
DELETE /api/bookings/:id          # äºˆç´„å‰Šé™¤
GET    /api/bookings/available    # åˆ©ç”¨å¯èƒ½æ™‚é–“å–å¾—
```

#### ç®¡ç†è€…é–¢é€£
```
GET    /api/admin/bookings        # å…¨äºˆç´„ä¸€è¦§ï¼ˆç®¡ç†è€…ï¼‰
PUT    /api/admin/bookings/:id    # äºˆç´„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
GET    /api/admin/users           # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
GET    /api/admin/stats           # çµ±è¨ˆæƒ…å ±
```

#### Cal.comé€£æº
```
POST   /api/cal/sync              # Cal.comåŒæœŸ
GET    /api/cal/events            # Cal.comã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
POST   /api/cal/webhook           # Cal.com Webhookå—ä¿¡
```

### 6.2 API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
```typescript
// æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œãŒå®Œäº†ã—ã¾ã—ãŸ"
}

// ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼",
    "details": { ... }
  }
}
```

---

## 7. çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 7.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ
```sql
-- å…±é€šã®Supabase PostgreSQL
-- cal.comã¨booking-systemãŒåŒã˜DBã‚’å‚ç…§

-- äºˆç´„ãƒ†ãƒ¼ãƒ–ãƒ«ã®çµ±åˆ
CREATE TABLE bookings (
  id UUID PRIMARY KEY,
  -- booking-systemå›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  staff_id UUID REFERENCES staff(id),
  service_id UUID REFERENCES services(id),
  customer_name VARCHAR(255),
  
  -- cal.comé€£æºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  cal_event_id VARCHAR(255),
  attendee_email VARCHAR(255),
  
  -- å…±é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  start_time TIMESTAMP WITH TIME ZONE,
  end_time TIMESTAMP WITH TIME ZONE,
  status VARCHAR(20),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 7.2 APIçµ±åˆ
```typescript
// API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµ±åˆ
// booking-system/src/app/api/bookings/route.ts

export async function POST(request: Request) {
  try {
    const body = await request.json()
    
    // 1. booking-system DBã«ä¿å­˜
    const booking = await prisma.booking.create({
      data: {
        staffId: body.staffId,
        serviceId: body.serviceId,
        startTime: new Date(body.startTime),
        endTime: new Date(body.endTime),
        customerName: body.customerName,
        // ... ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      }
    })
    
    // 2. Cal.com APIã«ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
    const calEvent = await createCalComEvent({
      title: `${body.customerName} - ${body.serviceName}`,
      startTime: body.startTime,
      endTime: body.endTime,
      attendeeEmail: body.customerEmail
    })
    
    // 3. cal_event_idã‚’æ›´æ–°
    await prisma.booking.update({
      where: { id: booking.id },
      data: { calEventId: calEvent.id }
    })
    
    return Response.json({ success: true, id: booking.id })
  } catch (error) {
    return Response.json({ error: error.message }, { status: 500 })
  }
}
```

### 7.3 ç’°å¢ƒå¤‰æ•°çµ±åˆ
```bash
# .env çµ±åˆä¾‹
# Supabaseè¨­å®šï¼ˆå…±é€šï¼‰
NEXT_PUBLIC_SUPABASE_URL=https://sazeyphxijxtgetnmvdk.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šï¼ˆcal.comå„ªå…ˆï¼‰
DATABASE_URL=postgresql://postgres:Skakeru173!@db.sazeyphxijxtgetnmvdk.supabase.co:5432/postgres
DATABASE_DIRECT_URL=postgresql://postgres:Skakeru173!@db.sazeyphxijxtgetnmvdk.supabase.co:5432/postgres

# èªè¨¼è¨­å®šï¼ˆå…±é€šï¼‰
NEXTAUTH_SECRET=1uNfajifjafojaofjaofjoaj
CALENDSO_ENCRYPTION_KEY=fnsifjiajfoajfoajofjaojfaof

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
NEXT_PUBLIC_WEBAPP_URL=http://localhost:3000    # cal.com
NEXT_PUBLIC_BASE_URL=http://localhost:3001      # booking-system
PORT=3001                                       # booking-systemç”¨
```

### 7.4 å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

#### äºˆç´„ä½œæˆãƒ•ãƒ­ãƒ¼
```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant BS as booking-system
    participant DB as Supabase DB
    participant CC as cal.com
    participant C as Cal.com API

    U->>BS: äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
    BS->>DB: äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    BS->>C: Cal.comã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
    C->>CC: ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
    CC->>DB: Webhookã§ç¢ºèª
    BS->>U: äºˆç´„å®Œäº†é€šçŸ¥
```

#### ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ•ãƒ­ãƒ¼
```typescript
// åŒæ–¹å‘åŒæœŸã®å®Ÿè£…
class BookingSync {
  // booking-system â†’ cal.com
  async syncToCalCom(booking: Booking) {
    if (!booking.calEventId) {
      // æ–°è¦ä½œæˆ
      const calEvent = await this.calComClient.createEvent(booking)
      await this.updateCalEventId(booking.id, calEvent.id)
    } else {
      // æ›´æ–°
      await this.calComClient.updateEvent(booking.calEventId, booking)
    }
  }
  
  // cal.com â†’ booking-system
  async syncFromCalCom(calEvent: CalEvent) {
    const booking = await this.findBookingByCalEventId(calEvent.id)
    if (booking) {
      await this.updateBooking(booking.id, {
        startTime: calEvent.startTime,
        endTime: calEvent.endTime,
        status: this.mapCalStatus(calEvent.status)
      })
    }
  }
}
```

---

## 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 8.1 èªè¨¼ãƒ»èªå¯
```typescript
// Supabase Auth + NextAuthçµ±åˆ
interface SecurityConfig {
  auth: {
    provider: 'supabase' | 'nextauth'
    jwt: {
      secret: string
      expiresIn: string
    }
    cors: {
      origin: string[]
      credentials: boolean
    }
  }
  
  authorization: {
    roles: ['USER', 'ADMIN', 'STAFF']
    permissions: {
      USER: ['read_own_bookings', 'create_booking']
      ADMIN: ['read_all_bookings', 'manage_users', 'manage_staff']
      STAFF: ['read_staff_bookings', 'update_booking_status']
    }
  }
}
```

### 8.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·
```typescript
// æ©Ÿå¯†æƒ…å ±ã®æš—å·åŒ–
class EncryptionService {
  private key: string
  
  encrypt(data: string): string {
    // AES-256æš—å·åŒ–
    return crypto.encrypt(data, this.key)
  }
  
  decrypt(encryptedData: string): string {
    // å¾©å·åŒ–
    return crypto.decrypt(encryptedData, this.key)
  }
}
```

### 8.3 API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **Rate Limiting**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™
- **API Key**: ç®¡ç†è€…APIç”¨
- **CORS**: é©åˆ‡ãªã‚ªãƒªã‚¸ãƒ³è¨­å®š
- **Input Sanitization**: å…¥åŠ›å€¤ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

---

## 9. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 9.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
```typescript
// Redis + ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
class CacheManager {
  private redis: Redis
  private memoryCache: Map<string, any>
  
  async get(key: string): Promise<any> {
    // 1. ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
    if (this.memoryCache.has(key)) {
      return this.memoryCache.get(key)
    }
    
    // 2. Redisç¢ºèª
    const value = await this.redis.get(key)
    if (value) {
      this.memoryCache.set(key, value)
      return value
    }
    
    return null
  }
}
```

### 9.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
```sql
-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_bookings_staff_time ON bookings(staff_id, start_time);
CREATE INDEX idx_bookings_service_time ON bookings(service_id, start_time);
CREATE INDEX idx_bookings_status_time ON bookings(status, start_time);

-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰
CREATE TABLE bookings_2024 PARTITION OF bookings
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

---

## 10. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ

### 10.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
```bash
# 1. cal.comèµ·å‹•
cd cal.com
docker-compose up -d

# 2. booking-systemèµ·å‹•
cd booking-system
$env:PORT=3001; npm run dev

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
npx prisma studio
```

### 10.2 ãƒãƒ¼ãƒˆè¨­å®š
```typescript
// ãƒãƒ¼ãƒˆç«¶åˆå›é¿
const ports = {
  calcom: 3000,        // æ±ç”¨äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 
  bookingSystem: 3001, // ç¾å®¹é™¢ç‰¹åŒ–ã‚·ã‚¹ãƒ†ãƒ 
  redis: 6379,         // ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  prismaStudio: 5555   // DBç®¡ç†ç”»é¢
}
```

### 10.3 ç’°å¢ƒå¤‰æ•°ç®¡ç†
```bash
# .env.local
NEXT_PUBLIC_API_URL=http://localhost:8000
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
CALCOM_API_URL=http://localhost:3000
```

---

## 11. ç›£è¦–ãƒ»ãƒ­ã‚°

### 11.1 ãƒ­ã‚°ç®¡ç†
```typescript
// æ§‹é€ åŒ–ãƒ­ã‚°
interface LogEntry {
  timestamp: string
  level: 'info' | 'warn' | 'error'
  service: 'calcom' | 'booking-system'
  action: string
  userId?: string
  metadata: Record<string, any>
}

class Logger {
  log(entry: LogEntry) {
    // 1. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    console.log(JSON.stringify(entry))
    
    // 2. ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
    this.writeToFile(entry)
    
    // 3. å¤–éƒ¨ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹é€ä¿¡
    this.sendToMonitoring(entry)
  }
}
```

### 11.2 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```typescript
// ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ç›£è¦–
class HealthChecker {
  async checkSystemHealth(): Promise<HealthStatus> {
    const checks = await Promise.all([
      this.checkDatabase(),
      this.checkCalComAPI(),
      this.checkRedis(),
      this.checkFileStorage()
    ])
    
    return {
      status: checks.every(c => c.healthy) ? 'healthy' : 'degraded',
      checks,
      timestamp: new Date().toISOString()
    }
  }
}
```

---

## 12. ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»

### Phase 1: åŸºç›¤å¼·åŒ–ï¼ˆ1-2é€±é–“ï¼‰
- [ ] ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–
- [ ] GraphQL APIå°å…¥
- [ ] WebSocketãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡

### Phase 2: æ©Ÿèƒ½æ‹¡å¼µï¼ˆ2-3é€±é–“ï¼‰
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå¯¾å¿œ
- [ ] å¤šè¨€èªå¯¾å¿œ
- [ ] é«˜åº¦ãªåˆ†ææ©Ÿèƒ½

### Phase 3: é‹ç”¨æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
- [ ] CI/CDè‡ªå‹•åŒ–
- [ ] è² è·åˆ†æ•£
- [ ] ç½å®³å¾©æ—§å¯¾ç­–

---

## ğŸ **ã¾ã¨ã‚**

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**cal.com**ã®æ±ç”¨æ€§ã¨**booking-system**ã®ç‰¹åŒ–æ€§ã‚’çµ„ã¿åˆã‚ã›ãŸã€é«˜åº¦ãªçµ±åˆäºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ä¸»è¦ãªç‰¹å¾´:**
1. **äºŒé‡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: æ±ç”¨ + ç‰¹åŒ–ã®æœ€é©ãªçµ„ã¿åˆã‚ã›
2. **ãƒ‡ãƒ¼ã‚¿çµ±åˆ**: å˜ä¸€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã®ä¸€å…ƒç®¡ç†
3. **APIçµ±åˆ**: åŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿åŒæœŸ
4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«ã‚ˆã‚‹æ‹¡å¼µæ€§
5. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹å®‰å…¨æ€§

**æŠ€è¡“çš„å„ªä½æ€§:**
- Next.js 14/15ã«ã‚ˆã‚‹æœ€æ–°ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- Prisma ORMã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
- Supabaseã«ã‚ˆã‚‹é«˜é€Ÿãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- Dockerã«ã‚ˆã‚‹ç’°å¢ƒã®ä¸€è²«æ€§
- TypeScriptã«ã‚ˆã‚‹é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ç¾å®¹é™¢ã®äºˆç´„ç®¡ç†ã‹ã‚‰ä¼æ¥­ã®ä¼šè­°å®¤äºˆç´„ã¾ã§ã€å¹…åºƒã„ç”¨é€”ã«å¯¾å¿œã§ãã‚‹æŸ”è»Ÿã§å …ç‰¢ãªã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ“š **å‚è€ƒè³‡æ–™**

- [Next.js Documentation](https://nextjs.org/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Cal.com Documentation](https://developer.cal.com/)
- [Zustand Documentation](https://zustand-demo.pmnd.rs/)

---

**æ–‡æ›¸ä½œæˆæ—¥**: 2025å¹´8æœˆ13æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**ä½œæˆè€…**: AI Assistant  
**æœ€çµ‚æ›´æ–°**: 2025å¹´8æœˆ13æ—¥ 