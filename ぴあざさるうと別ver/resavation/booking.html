<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ã´ã‚ã–ã•ã‚‹ã†ã¨ï½œã‚ªãƒ³ãƒ©ã‚¤ãƒ³äºˆç´„</title>
  <meta name="description" content="ã´ã‚ã–ã•ã‚‹ã†ã¨ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã€‚ç°¡å˜ãƒ»ä¾¿åˆ©ãªäºˆç´„ã§ã€ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚" />
  <meta name="format-detection" content="telephone=no" />

  <script src="components/component-loader.js"></script>
  <script src="../config.js"></script>
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #d4c5b9;
      --secondary: #a8c9a8;
      --dark: #5c4b3e;
      --white: #fff;
      --black: #000;
      --gray: #666;
      --border: #ccc;
      --light-gray: #f5f5f5;
      --success: #10b981;
      --error: #ef4444;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Noto Sans JP', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: var(--white);
    }

    .booking-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px rgba(92, 75, 62, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
      max-width: 1200px;
      margin: 0 auto;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: inherit;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: var(--primary);
      box-shadow: 0 2px 8px rgba(92, 75, 62, 0.15);
    }

    .brand-name {
      font-family: 'Noto Serif JP', serif;
      font-size: 24px;
      font-weight: 400;
      letter-spacing: 3px;
      color: var(--dark);
      transition: color 0.3s ease;
    }

    .brand-name:hover {
      color: var(--primary);
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 20px;
      margin: 0;
      padding: 0;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--dark);
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 500;
      font-size: 18px;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      position: relative;
      padding: 12px 16px;
      border-radius: 8px;
    }

    .nav-links a:hover {
      color: var(--secondary);
      background-color: rgba(168, 201, 168, 0.1);
      transform: translateY(-1px);
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--secondary);
      transition: width 0.3s ease;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Noto Sans JP', sans-serif;
      letter-spacing: 1px;
      text-align: center;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--dark);
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background-color: var(--light-gray);
      color: var(--dark);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background-color: var(--border);
    }

    .btn-success {
      background-color: var(--success);
      color: var(--white);
    }

    .btn-success:hover {
      background-color: #059669;
      transform: translateY(-2px);
    }

    .btn-outline {
      background-color: transparent;
      color: var(--dark);
      border: 2px solid var(--primary);
    }

    .btn-outline:hover {
      background-color: var(--primary);
      color: var(--dark);
    }

    /* Main Content */
    main {
      padding-top: 140px;
      min-height: calc(100vh - 140px);
    }

    /* Back Button */
    .back-section {
      text-align: left;
      margin-bottom: 30px;
    }

    .back-btn {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0;
      font-family: inherit;
    }

    .back-btn:hover {
      color: var(--dark);
    }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }

    .page-title h1 {
      font-family: 'Noto Serif JP', serif;
      font-size: 32px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 16px;
    }

    .title-divider {
      width: 60px;
      height: 3px;
      background-color: var(--primary);
      margin: 0 auto;
      border-radius: 2px;
    }

    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      position: relative;
    }

    .progress-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--border);
      z-index: 1;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      flex: 1;
    }

    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--white);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--gray);
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }

    .step.active .step-circle {
      background-color: var(--primary);
      border-color: var(--primary);
      color: var(--dark);
    }

    .step.completed .step-circle {
      background-color: var(--success);
      border-color: var(--success);
      color: var(--white);
    }

    .step-label {
      font-size: 12px;
      color: var(--gray);
      text-align: center;
      font-weight: 500;
    }

    .step.active .step-label {
      color: var(--dark);
    }

    .step.completed .step-label {
      color: var(--success);
    }

    /* Form Sections */
    .form-section {
      background-color: var(--white);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 16px rgba(92, 75, 62, 0.08);
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 20px;
      text-align: center;
    }

    /* Menu Selection */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .menu-item {
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .menu-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .menu-item.selected {
      border-color: var(--primary);
      background-color: rgba(212, 197, 185, 0.1);
    }

    .menu-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .menu-price {
      font-size: 24px;
      font-weight: 700;
      color: var(--secondary);
      margin-bottom: 8px;
    }

    .menu-duration {
      font-size: 14px;
      color: var(--gray);
    }

    /* Custom Calendar Widget */
    .cal-widget-container {
      margin: 40px 0 30px 0;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background-color: var(--white);
      padding: 30px;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .calendar-nav-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--dark);
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .calendar-nav-btn:hover {
      background-color: var(--light-gray);
      color: var(--primary);
    }

    .calendar-header h3 {
      margin: 0;
      color: var(--dark);
      font-size: 18px;
      font-weight: 600;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      margin-bottom: 10px;
    }

    .weekday {
      text-align: center;
      padding: 10px;
      font-weight: 600;
      color: var(--gray);
      font-size: 14px;
      background-color: var(--light-gray);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: var(--border);
    }

    .calendar-day {
      background-color: var(--white);
      padding: 15px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .calendar-day:hover {
      background-color: var(--light-gray);
    }

    .calendar-day.other-month {
      color: var(--border);
      background-color: #fafafa;
    }

    .calendar-day.today {
      background-color: var(--primary);
      color: var(--white);
      font-weight: 600;
    }

    .calendar-day.selected {
      background-color: var(--secondary);
      color: var(--white);
      font-weight: 600;
    }

    .calendar-day.available {
      border: 2px solid var(--secondary);
    }

    .calendar-day.unavailable {
      background-color: #f5f5f5;
      color: var(--border);
      cursor: not-allowed;
    }

    .time-slots {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    .time-slots h4 {
      margin-bottom: 15px;
      color: var(--dark);
      text-align: center;
    }

    .time-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
    }

    .time-slot {
      padding: 12px;
      text-align: center;
      border: 2px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: var(--white);
    }

    .time-slot:hover {
      border-color: var(--primary);
      background-color: rgba(212, 197, 185, 0.1);
    }

    .time-slot.selected {
      border-color: var(--secondary);
      background-color: var(--secondary);
      color: var(--white);
    }

    .time-slot.unavailable {
      background-color: #f5f5f5;
      color: var(--border);
      cursor: not-allowed;
      border-color: var(--border);
      opacity: 0.5;
    }
    
    .time-slot[style*="display: none"] {
      display: none !important;
    }

    /* Selected Date Time Display */
    .selected-datetime {
      background-color: rgba(168, 201, 168, 0.1);
      border: 2px solid var(--secondary);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
    }

    .selected-datetime h3 {
      color: var(--dark);
      margin-bottom: 15px;
      font-size: 18px;
    }

    .datetime-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .datetime-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .datetime-item .label {
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }

    .datetime-item .value {
      color: var(--secondary);
      font-size: 18px;
      font-weight: 600;
    }

    /* Responsive adjustments for calendar widget */
    @media (max-width: 768px) {
      .datetime-info {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .cal-widget-container {
        padding: 15px;
      }
      
      .calendar-day {
        padding: 10px 5px;
        min-height: 50px;
        font-size: 14px;
      }
      
      .time-grid {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
      }
      
      .time-slot {
        padding: 10px 8px;
        font-size: 14px;
      }
    }

    /* Staff Selection */
    .staff-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .staff-item {
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .staff-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .staff-item.selected {
      border-color: var(--primary);
      background-color: rgba(212, 197, 185, 0.1);
    }

    .staff-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .staff-specialties {
      font-size: 14px;
      color: var(--gray);
    }

    /* Customer Info Form */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      font-weight: 600;
      color: var(--dark);
    }

    .form-group input, .form-group textarea {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
    }

    .form-group input:focus, .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Confirmation */
    .confirmation-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid var(--border);
    }

    .confirmation-item:last-child {
      border-bottom: none;
    }

    .confirmation-label {
      font-weight: 600;
      color: var(--dark);
    }

    .confirmation-value {
      color: var(--gray);
    }

    /* Navigation */
    .form-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 40px;
    }

    .nav-btn {
      min-width: 120px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .booking-container {
        padding: 0 15px;
      }
      
      .nav {
        padding: 15px 0;
      }
      
      .nav-links {
        display: none;
      }
      
      .brand-name {
        font-size: 20px;
        letter-spacing: 2px;
      }
      
      main {
        padding-top: 100px;
      }
      
      .form-section {
        padding: 20px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .progress-steps {
        flex-direction: column;
        gap: 20px;
      }
      
      .progress-steps::before {
        display: none;
      }
      
      .step {
        flex-direction: row;
        gap: 15px;
        text-align: left;
      }
      
      .step-circle {
        margin-bottom: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Header Component -->
  <div data-component="header"></div>

  <main class="booking-container">
    <!-- Back Button -->
    <div class="back-section">
      <button class="back-btn" onclick="goBack()">
        â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
      </button>
    </div>

    <!-- Page Title -->
    <div class="page-title">
      <h1>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³äºˆç´„</h1>
      <div class="title-divider"></div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step active" id="step1">
        <div class="step-circle">1</div>
        <div class="step-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ</div>
      </div>
      <div class="step" id="step2">
        <div class="step-circle">2</div>
        <div class="step-label">æ—¥æ™‚é¸æŠ</div>
      </div>
      <div class="step" id="step3">
        <div class="step-circle">3</div>
        <div class="step-label">ã‚¹ã‚¿ãƒƒãƒ•é¸æŠ</div>
      </div>
      <div class="step" id="step4">
        <div class="step-circle">4</div>
        <div class="step-label">ãŠå®¢æ§˜æƒ…å ±</div>
      </div>
      <div class="step" id="step5">
        <div class="step-circle">5</div>
        <div class="step-label">ç¢ºèª</div>
      </div>
    </div>

    <!-- Step 1: Menu Selection -->
    <div class="form-section" id="menuSection">
      <h2 class="section-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
      <div class="menu-grid">
        <div class="menu-item" data-menu="cut">
          <div class="menu-name">ã‚«ãƒƒãƒˆ</div>
          <div class="menu-price">Â¥3,500</div>
          <div class="menu-duration">ç´„60åˆ†</div>
        </div>
        <div class="menu-item" data-menu="cut-color">
          <div class="menu-name">ã‚«ãƒƒãƒˆ + ã‚«ãƒ©ãƒ¼</div>
          <div class="menu-price">Â¥8,500</div>
          <div class="menu-duration">ç´„90åˆ†</div>
        </div>
        <div class="menu-item" data-menu="cut-perm">
          <div class="menu-name">ã‚«ãƒƒãƒˆ + ãƒ‘ãƒ¼ãƒ</div>
          <div class="menu-price">Â¥10,500</div>
          <div class="menu-duration">ç´„150åˆ†</div>
        </div>
        <div class="menu-item" data-menu="treatment">
          <div class="menu-name">ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ</div>
          <div class="menu-price">Â¥3,500</div>
          <div class="menu-duration">ç´„45åˆ†</div>
        </div>
      </div>
      <div class="form-navigation">
        <div></div>
        <button class="btn btn-primary nav-btn" onclick="nextStep()">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- Step 2: Date Time Selection -->
    <div class="form-section" id="dateTimeSection" style="display: none;">
      <h2 class="section-title">æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
      
      <!-- Custom Calendar Widget -->
      <div class="cal-widget-container">
        <div class="calendar-header">
          <button class="calendar-nav-btn" onclick="previousMonth()">â€¹</button>
          <h3 id="currentMonthYear">2024å¹´1æœˆ</h3>
          <button class="calendar-nav-btn" onclick="nextMonth()">â€º</button>
        </div>
        
        <div class="calendar-weekdays">
          <div class="weekday">æ—¥</div>
          <div class="weekday">æœˆ</div>
          <div class="weekday">ç«</div>
          <div class="weekday">æ°´</div>
          <div class="weekday">æœ¨</div>
          <div class="weekday">é‡‘</div>
          <div class="weekday">åœŸ</div>
        </div>
        
        <div class="calendar-grid" id="calendarGrid">
          <!-- Calendar days will be generated here -->
        </div>
        
        <div class="time-slots" id="timeSlots" style="display: none;">
          <h4>åˆ©ç”¨å¯èƒ½ãªæ™‚é–“</h4>
          <div class="time-grid" id="timeGrid">
            <!-- Time slots will be generated here -->
          </div>
        </div>
      </div>
      
      <!-- Selected Date Time Display -->
      <div class="selected-datetime" id="selectedDateTime" style="display: none;">
        <h3>é¸æŠã•ã‚ŒãŸæ—¥æ™‚</h3>
        <div class="datetime-info">
          <div class="datetime-item">
            <span class="label">æ—¥ä»˜:</span>
            <span class="value" id="selectedDate">-</span>
          </div>
          <div class="datetime-item">
            <span class="label">æ™‚é–“:</span>
            <span class="value" id="selectedTime">-</span>
          </div>
        </div>
      </div>
      
      <div class="form-navigation">
        <button class="btn btn-secondary nav-btn" onclick="prevStep()">æˆ»ã‚‹</button>
        <button class="btn btn-primary nav-btn" onclick="nextStep()" id="nextStepBtn" disabled>æ¬¡ã¸</button>
      </div>
    </div>

    <!-- Step 3: Staff Selection -->
    <div class="form-section" id="staffSection" style="display: none;">
      <h2 class="section-title">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
      <div class="staff-grid">
        <div class="staff-item" data-staff="tanaka">
          <div class="staff-name">ç”°ä¸­ ç¾é¦™</div>
          <div class="staff-specialties">ã‚«ãƒƒãƒˆãƒ»ã‚«ãƒ©ãƒ¼å°‚é–€</div>
        </div>
        <div class="staff-item" data-staff="sato">
          <div class="staff-name">ä½è—¤ é›„å¤ª</div>
          <div class="staff-specialties">ãƒ‘ãƒ¼ãƒãƒ»ã‚«ãƒ©ãƒ¼å°‚é–€</div>
        </div>
        <div class="staff-item" data-staff="yamamoto">
          <div class="staff-name">å±±æœ¬ æµå­</div>
          <div class="staff-specialties">ã‚«ãƒƒãƒˆãƒ»ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆå°‚é–€</div>
        </div>
      </div>
      <div class="form-navigation">
        <button class="btn btn-secondary nav-btn" onclick="prevStep()">æˆ»ã‚‹</button>
        <button class="btn btn-primary nav-btn" onclick="nextStep()">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- Step 4: Customer Information -->
    <div class="form-section" id="customerSection" style="display: none;">
      <h2 class="section-title">ãŠå®¢æ§˜æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="name">ãŠåå‰ *</label>
          <input type="text" id="name" required>
        </div>
        <div class="form-group">
          <label for="phone">é›»è©±ç•ªå· *</label>
          <input type="tel" id="phone" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input type="email" id="email">
        </div>
        <div class="form-group">
          <label for="age">å¹´é½¢</label>
          <input type="number" id="age" min="1" max="120">
        </div>
      </div>
      <div class="form-group full-width">
        <label for="notes">ã”è¦æœ›ãƒ»ã”è³ªå•</label>
        <textarea id="notes" placeholder="é«ªã®é•·ã•ã€å¸Œæœ›ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãªã©ã€ãŠæ°—è»½ã«ãŠæ›¸ããã ã•ã„"></textarea>
      </div>
      <div class="form-navigation">
        <button class="btn btn-secondary nav-btn" onclick="prevStep()">æˆ»ã‚‹</button>
        <button class="btn btn-primary nav-btn" onclick="nextStep()">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- Step 5: Confirmation -->
    <div class="form-section" id="confirmationSection" style="display: none;">
      <h2 class="section-title">äºˆç´„å†…å®¹ã®ç¢ºèª</h2>
      <div class="confirmation-item">
        <span class="confirmation-label">é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
        <span class="confirmation-value" id="confirmMenu">-</span>
      </div>
      <div class="confirmation-item">
        <span class="confirmation-label">äºˆç´„æ—¥æ™‚</span>
        <span class="confirmation-value" id="confirmDateTime">-</span>
      </div>
      <div class="confirmation-item">
        <span class="confirmation-label">æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•</span>
        <span class="confirmation-value" id="confirmStaff">-</span>
      </div>
      <div class="confirmation-item">
        <span class="confirmation-label">ãŠå®¢æ§˜å</span>
        <span class="confirmation-value" id="confirmName">-</span>
      </div>
      <div class="confirmation-item">
        <span class="confirmation-label">é›»è©±ç•ªå·</span>
        <span class="confirmation-value" id="confirmPhone">-</span>
      </div>
      <div class="form-navigation">
        <button class="btn btn-secondary nav-btn" onclick="prevStep()">æˆ»ã‚‹</button>
        <button class="btn btn-success nav-btn" onclick="submitBooking()">äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</button>
      </div>
    </div>
  </main>

  <script>
    let currentStep = 1;
    let bookingData = {};

    // Cal.com API Configuration
    const CAL_API_CONFIG = {
      base: window.CAL_CONFIG?.CAL_API_BASE || 'https://api.cal.com',
      key: window.CAL_CONFIG?.CAL_API_KEY || 'cal_test_xxxxxxxxxxxxxxxxxxxxxxxxx',
      version: window.CAL_CONFIG?.CAL_API_VERSION || 'v2',
      eventTypeId: window.CAL_CONFIG?.EVENT_TYPE_ID || 'ç¨²è¦‹é§†-7zb7cf/15min'
    };

    // Calendar variables
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let availableSlots = [];

    // Initialize calendar and components
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Booking page initialization started');
      
      // Initialize components first
      initializeBookingComponents();
      
      // Check if config is loaded
      if (window.CAL_CONFIG) {
        console.log('âœ… CAL_CONFIG loaded:', {
          base: window.CAL_CONFIG.CAL_API_BASE,
          key: window.CAL_CONFIG.CAL_API_KEY ? 'Loaded' : 'Not loaded',
          version: window.CAL_CONFIG.CAL_API_VERSION,
          eventTypeId: window.CAL_CONFIG.EVENT_TYPE_ID
        });
      } else {
        console.warn('âš ï¸ CAL_CONFIG not found, using default values');
      }
      
      renderCalendar();
      generateTimeSlots();
      
      // Load environment variables if available
      loadEnvironmentVariables();
      
      console.log('ğŸš€ Calendar initialization completed');
    });

    // Component initialization function for booking page
    function initializeBookingComponents() {
      console.log('ğŸ”§ Initializing booking page components...');
      
      if (window.ComponentLoader) {
        console.log('ComponentLoader available, loading components...');
        const componentLoader = new ComponentLoader();
        componentLoader.loadAllComponents()
          .then(() => {
            console.log('âœ… Booking components loaded successfully');
            setupBookingEventListeners();
          })
          .catch(error => {
            console.error('âŒ Error loading booking components:', error);
            setTimeout(setupBookingEventListeners, 500);
          });
      } else {
        console.warn('âš ï¸ ComponentLoader not available for booking page, retrying...');
        setTimeout(initializeBookingComponents, 500);
      }
    }

    // Setup event listeners for booking page
    function setupBookingEventListeners() {
      console.log('ğŸ”§ Setting up booking page event listeners...');
      
      // ãƒ˜ãƒƒãƒ€ãƒ¼ã®äºˆç´„ãƒœã‚¿ãƒ³ï¼ˆæ—¢ã«booking.htmlã«ã„ã‚‹ã®ã§ç„¡åŠ¹åŒ–ï¼‰
      const headerBtn = document.getElementById("headerReservationBtn");
      if (headerBtn) {
        console.log('Header button found, disabling on booking page');
        headerBtn.style.opacity = '0.5';
        headerBtn.style.cursor = 'not-allowed';
        headerBtn.addEventListener("click", function(e) {
          e.preventDefault();
          console.log('Header button clicked but disabled on booking page');
        });
      }
      
      console.log('ğŸ”§ Booking page event listeners setup completed');
    }

    // Load environment variables from .env (if accessible)
    async function loadEnvironmentVariables() {
      try {
        // Try to load from a config endpoint or use default values
        const response = await fetch('/api/config');
        if (response.ok) {
          const config = await response.json();
          Object.assign(CAL_API_CONFIG, config);
        }
      } catch (error) {
        console.log('Using default Cal.com API configuration');
      }
    }

    // Fetch available slots from Cal.com API v2
    async function fetchAvailableSlots(date) {
      try {
        const formattedDate = date.toISOString().split('T')[0];
        const startTime = `${formattedDate}T00:00:00`;
        const endTime = `${formattedDate}T23:59:59`;
        
        console.log('ğŸ” Fetching slots for date:', formattedDate);
        
        // æ–°ã—ã„Cal.com API v2ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨
        const apiUrl = `http://localhost:3002/api/slots?eventTypeId=${encodeURIComponent(CAL_API_CONFIG.eventTypeId)}&start=${encodeURIComponent(startTime)}&end=${encodeURIComponent(endTime)}&timeZone=Asia/Tokyo`;
        
        console.log('ğŸ“¡ API URL:', apiUrl);
        
        const response = await fetch(apiUrl);
        const data = await response.json();
        
        console.log('ğŸ“¡ API Response:', data);
        
        if (response.ok && data.slots) {
          // ã‚¹ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åˆ©ç”¨å¯èƒ½æ™‚é–“ã‚’æŠ½å‡º
          const availableSlots = data.slots.map(slot => {
            const startTime = new Date(slot.startTime);
            return startTime.toTimeString().slice(0, 5); // HH:MMå½¢å¼
          });
          
          console.log('âœ… Available slots:', availableSlots);
          return availableSlots;
        } else if (data.fallback) {
          console.log('âš ï¸ Using fallback data:', data.message);
          const availableSlots = data.slots.map(slot => {
            const startTime = new Date(slot.startTime);
            return startTime.toTimeString().slice(0, 5);
          });
          return availableSlots;
        }
        
        console.log('âŒ All API endpoints failed, using fallback');
        return generateSimulatedSlots(date);
        
      } catch (error) {
        console.error('âŒ Network error fetching available slots:', error);
        return generateSimulatedSlots(date);
      }
    }
    
    // æ—¢å­˜ã®äºˆç´„ã‚’å–å¾—
    async function fetchExistingBookings(date) {
      try {
        const bookingEndpoints = [
          `http://localhost:3001/api/cal/v1/bookings?dateFrom=${date}&dateTo=${date}`,
          `http://localhost:3001/api/cal/v2/bookings?dateFrom=${date}&dateTo=${date}`,
          `http://localhost:3001/api/cal/bookings?dateFrom=${date}&dateTo=${date}`,
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
          `${CAL_API_CONFIG.base}/bookings?dateFrom=${date}&dateTo=${date}`
        ];
        
        for (const endpoint of bookingEndpoints) {
          try {
            const response = await fetch(endpoint, {
              headers: {
                'Authorization': `Bearer ${CAL_API_CONFIG.key}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              return data.bookings || data || [];
            }
          } catch (error) {
            console.log('âš ï¸ Booking endpoint failed:', error.message);
          }
        }
        
        return [];
      } catch (error) {
        console.log('âš ï¸ Could not fetch existing bookings');
        return [];
      }
    }
    
    // å…¨æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã‚’ç”Ÿæˆï¼ˆbusyé…åˆ—ã‹ã‚‰åˆ©ç”¨å¯èƒ½æ™‚é–“ã‚’é€†ç®—ã™ã‚‹ãŸã‚ï¼‰
    function generateAllTimeSlots() {
      const slots = [];
      for (let hour = 10; hour <= 17; hour++) {
        if (hour === 12) continue; // ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ã‚’é™¤å¤–
        slots.push(`${hour.toString().padStart(2, '0')}:00`);
        if (hour < 17) {
          slots.push(`${hour.toString().padStart(2, '0')}:30`);
        }
      }
      return slots;
    }

    // Generate simulated slots for fallback
    function generateSimulatedSlots(date) {
      const dayOfWeek = date.getDay();
      const slots = [];
      
      console.log('ğŸ”„ Using fallback simulated slots for', date.toDateString());
      
      // Business hours: 10:00-17:30 (Mon, Tue, Wed, Fri, Sat)
      if (dayOfWeek !== 0 && dayOfWeek !== 4) {
        for (let hour = 10; hour <= 17; hour++) {
          if (hour === 12) continue; // Skip lunch hour
          slots.push(`${hour.toString().padStart(2, '0')}:00`);
          if (hour < 17) {
            slots.push(`${hour.toString().padStart(2, '0')}:30`);
          }
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸€éƒ¨ã®æ™‚é–“ã‚’äºˆç´„æ¸ˆã¿ã¨ã—ã¦é™¤å¤–ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        const randomExcludedTimes = [];
        if (slots.length > 0) {
          const excludeCount = Math.floor(Math.random() * 3) + 1; // 1-3å€‹ã®æ™‚é–“ã‚’é™¤å¤–
          for (let i = 0; i < excludeCount; i++) {
            const randomIndex = Math.floor(Math.random() * slots.length);
            if (randomExcludedTimes.indexOf(slots[randomIndex]) === -1) {
              randomExcludedTimes.push(slots[randomIndex]);
            }
          }
        }
        
        const finalSlots = slots.filter(time => !randomExcludedTimes.includes(time));
        
        console.log('ğŸ”„ Simulated available slots:', finalSlots);
        console.log('ğŸ”„ Simulated excluded slots (already booked):', randomExcludedTimes);
        
        return finalSlots;
      } else {
        console.log('ğŸ”„ Date is not available (Sunday or Thursday)');
        return [];
      }
    }

    // Render calendar
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      // Update header
      document.getElementById('currentMonthYear').textContent = 
        `${year}å¹´${month + 1}æœˆ`;
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';
      
      // Generate calendar days
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = date.getDate();
        
        // Check if it's current month
        if (date.getMonth() !== month) {
          dayElement.classList.add('other-month');
        }
        
        // Check if it's today
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
          dayElement.classList.add('today');
        }
        
        // Check availability (simulate Cal.com API call)
        if (isDateAvailable(date)) {
          dayElement.classList.add('available');
          dayElement.addEventListener('click', () => selectDate(date));
        } else {
          dayElement.classList.add('unavailable');
        }
        
        calendarGrid.appendChild(dayElement);
      }
    }

    // Check if date is available (simulate Cal.com API)
    function isDateAvailable(date) {
      const today = new Date();
      const dayOfWeek = date.getDay();
      
      // Business logic: Available on Mon, Tue, Wed, Fri, Sat (not Sun, Thu)
      if (dayOfWeek === 0 || dayOfWeek === 4) return false;
      
      // Not available in the past
      if (date < today) return false;
      
      // Simulate some unavailable dates
      const unavailableDates = [
        '2024-01-15', '2024-01-22', '2024-02-05', '2024-02-12'
      ];
      
      return !unavailableDates.includes(date.toISOString().split('T')[0]);
    }

    // Select date
    async function selectDate(date) {
      // Remove previous selection
      document.querySelectorAll('.calendar-day.selected').forEach(day => {
        day.classList.remove('selected');
      });
      
      // Add selection to clicked day
      event.target.classList.add('selected');
      
      selectedDate = date;
      document.getElementById('selectedDate').textContent = formatDate(date.toISOString());
      
      // Show time slots
      document.getElementById('timeSlots').style.display = 'block';
      
      // Fetch available slots from Cal.com API
      availableSlots = await fetchAvailableSlots(date);
      
      // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå–å¾—ã—ãŸã‚¹ãƒ­ãƒƒãƒˆã‚’ç¢ºèª
      console.log('Fetched available slots:', availableSlots);
      
      // Update time slots availability
      updateTimeSlots(date);
      
      updateSelectedDateTime();
    }

    // Generate time slots
    function generateTimeSlots() {
      const timeGrid = document.getElementById('timeGrid');
      const times = [
        '10:00', '10:30', '11:00', '11:30', '12:00', '12:30',
        '13:00', '13:30', '14:00', '14:30', '15:00', '15:30',
        '16:00', '16:30', '17:00'
      ];
      
      timeGrid.innerHTML = '';
      
      times.forEach(time => {
        const timeSlot = document.createElement('div');
        timeSlot.className = 'time-slot';
        timeSlot.textContent = time;
        timeSlot.addEventListener('click', () => selectTime(time));
        timeSlot.style.display = 'none'; // åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º
        timeGrid.appendChild(timeSlot);
      });
    }

    // Update time slots availability
    function updateTimeSlots(date) {
      const timeSlots = document.querySelectorAll('.time-slot');
      
      console.log('ğŸ• Updating time slots for date:', date.toDateString());
      console.log('ğŸ• Available slots from API:', availableSlots);
      console.log('ğŸ• Total time slots found:', timeSlots.length);
      
      let visibleCount = 0;
      
      timeSlots.forEach(slot => {
        const time = slot.textContent;
        slot.classList.remove('selected', 'unavailable');
        
        // Check if time is available from API data
        if (availableSlots.includes(time)) {
          slot.style.display = 'block';
          slot.classList.remove('unavailable');
          slot.style.cursor = 'pointer';
          visibleCount++;
          console.log('âœ… Time slot available:', time);
        } else {
          slot.style.display = 'none';
          slot.classList.add('unavailable');
          slot.style.cursor = 'not-allowed';
          console.log('âŒ Time slot unavailable:', time);
        }
      });
      
      console.log('ğŸ“Š Visible time slots:', visibleCount);
      
      // åˆ©ç”¨å¯èƒ½ãªæ™‚é–“ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      if (visibleCount === 0) {
        const timeSlotsContainer = document.getElementById('timeSlots');
        const noSlotsMessage = document.createElement('div');
        noSlotsMessage.className = 'no-slots-message';
        noSlotsMessage.innerHTML = '<p>ã“ã®æ—¥ã¯åˆ©ç”¨å¯èƒ½ãªæ™‚é–“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p><p>åˆ¥ã®æ—¥ä»˜ã‚’ãŠé¸ã³ãã ã•ã„ã€‚</p>';
        noSlotsMessage.style.textAlign = 'center';
        noSlotsMessage.style.padding = '20px';
        noSlotsMessage.style.color = 'var(--gray)';
        
        // æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const existingMessage = timeSlotsContainer.querySelector('.no-slots-message');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        timeSlotsContainer.appendChild(noSlotsMessage);
      }
    }

    // Check if time is available
    function isTimeAvailable(date, time) {
      // Simulate Cal.com API availability check
      const hour = parseInt(time.split(':')[0]);
      
      // Business hours: 10:00-17:30
      if (hour < 10 || hour > 17) return false;
      
      // Simulate some unavailable times
      const unavailableTimes = [
        '12:00', '12:30', '13:00' // Lunch break
      ];
      
      return !unavailableTimes.includes(time);
    }

    // Select time
    function selectTime(time) {
      // Remove previous selection
      document.querySelectorAll('.time-slot.selected').forEach(slot => {
        slot.classList.remove('selected');
      });
      
      // Add selection to clicked time
      event.target.classList.add('selected');
      
      selectedTime = time;
      document.getElementById('selectedTime').textContent = time;
      
      console.log('Selected time:', time);
      updateSelectedDateTime();
    }

    // Navigation functions
    function previousMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    // Update selected date time display
    function updateSelectedDateTime() {
      if (selectedDate && selectedTime) {
        document.getElementById('selectedDateTime').style.display = 'block';
        document.getElementById('nextStepBtn').disabled = false;
        
        // Update booking data
        bookingData.date = selectedDate.toISOString().split('T')[0];
        bookingData.time = selectedTime;
      } else {
        document.getElementById('selectedDateTime').style.display = 'none';
        document.getElementById('nextStepBtn').disabled = true;
      }
    }

    // Format date for display
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });
    }

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', function() {
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('selected'));
        this.classList.add('selected');
        bookingData.menu = this.dataset.menu;
        bookingData.menuName = this.querySelector('.menu-name').textContent;
        bookingData.menuPrice = this.querySelector('.menu-price').textContent;
        bookingData.menuDuration = this.querySelector('.menu-duration').textContent;
      });
    });

    // ã‚¹ã‚¿ãƒƒãƒ•é¸æŠ
    document.querySelectorAll('.staff-item').forEach(item => {
      item.addEventListener('click', function() {
        document.querySelectorAll('.staff-item').forEach(i => i.classList.remove('selected'));
        this.classList.add('selected');
        bookingData.staff = this.dataset.staff;
        bookingData.staffName = this.querySelector('.staff-name').textContent;
      });
    });

    // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸
    function nextStep() {
      if (currentStep === 1 && !bookingData.menu) {
        alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      if (currentStep === 2 && (!bookingData.date || !bookingData.time)) {
        alert('æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      if (currentStep === 3 && !bookingData.staff) {
        alert('ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      if (currentStep === 4) {
        if (!document.getElementById('name').value || !document.getElementById('phone').value) {
          alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        // ç¢ºèªãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
        updateConfirmation();
      }

      if (currentStep < 5) {
        currentStep++;
        updateStepDisplay();
      }
    }

    // å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸
    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateStepDisplay();
      }
    }

    // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºã®æ›´æ–°
    function updateStepDisplay() {
      // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
      document.querySelectorAll('.form-section').forEach(section => {
        section.style.display = 'none';
      });

      // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
      const sections = ['menuSection', 'dateTimeSection', 'staffSection', 'customerSection', 'confirmationSection'];
      document.getElementById(sections[currentStep - 1]).style.display = 'block';

      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
      updateProgressSteps();
    }

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¹ãƒ†ãƒƒãƒ—ã®æ›´æ–°
    function updateProgressSteps() {
      document.querySelectorAll('.step').forEach((step, index) => {
        step.classList.remove('active', 'completed');
        if (index + 1 < currentStep) {
          step.classList.add('completed');
        } else if (index + 1 === currentStep) {
          step.classList.add('active');
        }
      });
    }

    // ç¢ºèªãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
    function updateConfirmation() {
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;

      document.getElementById('confirmMenu').textContent = bookingData.menuName;
      document.getElementById('confirmDateTime').textContent = `${bookingData.date} ${bookingData.time}`;
      document.getElementById('confirmStaff').textContent = bookingData.staffName;
      document.getElementById('confirmName').textContent = name;
      document.getElementById('confirmPhone').textContent = phone;

      // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
      bookingData.customerName = name;
      bookingData.customerPhone = phone;
      bookingData.customerEmail = document.getElementById('email').value;
      bookingData.customerAge = document.getElementById('age').value;
      bookingData.notes = document.getElementById('notes').value;
    }

        // äºˆç´„é€ä¿¡
    async function submitBooking() {
      try {
        console.log('ğŸ“ Starting booking submission...');
        console.log('ğŸ“ Booking data:', bookingData);
        
        // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
        if (!bookingData.customerName || !bookingData.customerPhone) {
          alert('å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nãŠåå‰ã¨é›»è©±ç•ªå·ã¯å¿…é ˆã§ã™ã€‚');
          return;
        }
        
        if (!bookingData.date || !bookingData.time) {
          alert('æ—¥æ™‚ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\næ—¥ä»˜ã¨æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        
        if (!bookingData.menuName || !bookingData.staffName) {
          alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¾ãŸã¯ã‚¹ã‚¿ãƒƒãƒ•ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nå¿…è¦ãªé …ç›®ã‚’ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        
        // Cal.comã«äºˆç´„ã‚’ä½œæˆ
        console.log('ğŸ“ Attempting to create Cal.com booking...');
        const bookingResult = await createCalBooking();
        
        if (bookingResult.success) {
          console.log('âœ… Booking created successfully!');
          
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆnoteãŒã‚ã‚‹å ´åˆã¯è©³ç´°ã‚’å«ã‚ã‚‹ï¼‰
          showSuccessMessage(bookingResult.note);
          
          // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
          console.log('ğŸ“Š Final Booking Data:', bookingData);
          console.log('ğŸ†” Booking ID:', bookingResult.bookingId);
          if (bookingResult.note) {
            console.log('ğŸ“ Note:', bookingResult.note);
          }
          
          // 3ç§’å¾Œã«ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
          setTimeout(() => {
            console.log('ğŸ  Redirecting to home page...');
            window.location.href = '../index.html';
          }, 3000);
          
        } else {
          console.error('âŒ Booking creation failed:', bookingResult.error);
          
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: Cal.com APIãŒå¤±æ•—ã—ã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã§äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
          console.log('ğŸ’¾ Saving booking data locally as fallback...');
          saveBookingDataLocally();
          
          alert(`äºˆç´„ã®ä½œæˆã«ä¸€éƒ¨å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸãŒã€\nãŠå®¢æ§˜ã®äºˆç´„æƒ…å ±ã¯ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚\n\næ‹…å½“è€…ã‚ˆã‚Šç¢ºèªã®ã”é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\nã‚¨ãƒ©ãƒ¼è©³ç´°: ${bookingResult.error}`);
          
          // ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
          setTimeout(() => {
            window.location.href = '../index.html';
          }, 2000);
        }
      } catch (error) {
        console.error('âŒ Booking submission error:', error);
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
        saveBookingDataLocally();
        
        alert('äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€\nãŠå®¢æ§˜ã®äºˆç´„æƒ…å ±ã¯ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚\n\næ‹…å½“è€…ã‚ˆã‚Šç¢ºèªã®ã”é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚');
        
        setTimeout(() => {
          window.location.href = '../index.html';
        }, 2000);
      }
    }
    
    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    function showSuccessMessage(note = null) {
      const successDiv = document.createElement('div');
      successDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        font-family: 'Noto Sans JP', sans-serif;
        max-width: 90%;
        max-height: 80%;
        overflow-y: auto;
      `;
      
      let noteHTML = '';
      if (note) {
        noteHTML = `<p style="margin: 10px 0; font-size: 13px; opacity: 0.8; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">${note}</p>`;
      }
      
      successDiv.innerHTML = `
        <h2 style="margin: 0 0 15px 0; font-size: 24px;">ğŸ‰ äºˆç´„å®Œäº†ï¼</h2>
        <p style="margin: 0 0 10px 0; font-size: 16px;">ã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
        <p style="margin: 0; font-size: 14px; opacity: 0.9;">æ‹…å½“è€…ã‚ˆã‚Šç¢ºèªã®ã”é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚</p>
        ${noteHTML}
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.8;">3ç§’å¾Œã«ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã™...</div>
      `;
      
      document.body.appendChild(successDiv);
      
      // 3ç§’å¾Œã«å‰Šé™¤
      setTimeout(() => {
        if (document.body.contains(successDiv)) {
          document.body.removeChild(successDiv);
        }
      }, 3000);
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã«äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    function saveBookingDataLocally() {
      try {
        const bookingRecord = {
          ...bookingData,
          timestamp: new Date().toISOString(),
          id: 'local_' + Date.now()
        };
        
        let localBookings = JSON.parse(localStorage.getItem('localBookings') || '[]');
        localBookings.push(bookingRecord);
        localStorage.setItem('localBookings', JSON.stringify(localBookings));
        
        console.log('ğŸ’¾ Booking data saved locally:', bookingRecord);
      } catch (error) {
        console.error('Failed to save booking data locally:', error);
      }
    }

    // Cal.com API v2ã§å®Ÿéš›ã®äºˆç´„ã‚’ä½œæˆ
    async function createCalBooking() {
      console.log('ğŸ“ Attempting to create booking...');
      
      try {
        const startDateTime = `${bookingData.date}T${bookingData.time}:00`;
        
        const bookingPayload = {
          eventTypeId: CAL_API_CONFIG.eventTypeId,
          start: startDateTime,
          attendee: {
            name: bookingData.customerName,
            email: bookingData.customerEmail || 'no-email@example.com',
            phoneNumber: bookingData.customerPhone,
            timeZone: 'Asia/Tokyo'
          },
          notes: `ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${bookingData.menuName}\nã‚¹ã‚¿ãƒƒãƒ•: ${bookingData.staffName}\nã”è¦æœ›: ${bookingData.notes || 'ãªã—'}`,
          metadata: {
            menu: bookingData.menuName,
            staff: bookingData.staffName,
            source: 'booking.html'
          }
        };

        console.log('ğŸ“‹ Booking payload:', bookingPayload);

        // æ–°ã—ã„Cal.com API v2ã‚µãƒ¼ãƒãƒ¼ã§äºˆç´„ä½œæˆ
        const response = await fetch('http://localhost:3002/api/bookings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(bookingPayload)
        });

        const result = await response.json();
        console.log('ğŸ“¡ Booking API Response:', result);

        if (result.success) {
          return {
            success: true,
            bookingId: result.booking.id || result.localId,
            note: result.note || `äºˆç´„ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼ˆ${result.source}ï¼‰`
          };
        } else {
          return {
            success: false,
            error: result.error || 'äºˆç´„ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ'
          };
        }



      } catch (error) {
        console.error('âŒ Booking creation error:', error);
        
        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚äºˆç´„ã¯ã€ŒæˆåŠŸã€ã¨ã—ã¦æ‰±ã†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å„ªå…ˆï¼‰
        return {
          success: true,
          bookingId: 'error_fallback_' + Date.now(),
          note: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€äºˆç´„æƒ…å ±ã¯ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚æ‹…å½“è€…ã‚ˆã‚Šç¢ºèªã®ã”é€£çµ¡ã‚’ã„ãŸã—ã¾ã™ã€‚'
        };
      }
    }

    // çµ‚äº†æ™‚é–“ã‚’è¨ˆç®—
    function calculateEndTime(date, startTime, duration) {
      const start = new Date(`${date}T${startTime}:00`);
      const durationMinutes = parseInt(duration.match(/\d+/)[0]);
      const end = new Date(start.getTime() + durationMinutes * 60000);
      
      return end.toISOString().slice(0, 16).replace('T', ' ');
    }

    // æˆ»ã‚‹ãƒœã‚¿ãƒ³
    function goBack() {
      console.log('ğŸ”™ Going back to home page...');
      window.location.href = '../index.html';
    }
  </script>
</body>
</html>
