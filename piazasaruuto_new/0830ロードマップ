方針（全体像）

目的：美容室の「集客〜予約〜当日運用」を1本で回す。迷わないUI＆ミスらない仕組みを最優先。

コア：公開サイト（SEO/信頼）＋ 予約フロー（Cal API）＋ 運用（キャンセル/変更/通知/集計）

成功指標

予約完了率（date→confirmの離脱を10%未満へ）

電話予約比率の低下（Web移行）

No-show率の低下（前日/当日リマインド）

段階的ロードマップ（マイルストーン＋受け入れ条件）
M1: 基盤と安全（完了/継続中）

✅ APIプロキシ（slots/reserve/bookings/cancel）

✅ UTF-8徹底（送受信・PowerShell手順）

✅ ガード実装：存在しないstart→409、過去時刻→400、必須チェック

受け入れ：無効startで409、正しいstartで201、キャンセルOK

M2: 予約フローUI（1入力/1ページの雛形→接続）

画面：menu → date → info → confirm → complete

要件：

高齢層向け：文字大きめ、ボタン大きめ、1画面1操作、戻る/次へ明確

date画面：/api/cal/slotsを叩いて当日スロットをボタンで選択

confirm画面：フォーム値を表示（Cal応答に依存しない）

受け入れ：最短3タップで予約完了できる／409の場合は「空き枠更新」を提案して自動リロード

M3: 運用ガワ（管理・後片付け）

管理向けミニページ：UID指定キャンセル、当日予約一覧（印刷用）

Webhook受信：CREATED/RESCHEDULED/CANCELLED ログ→（後でDB反映）

受け入れ：管理者だけのURLでキャンセル完了／Webhookが確実に届く

M4: データの“正”を自前で持つ（小さく始めるDB）

目的：日本語氏名や連絡先など表示に必要な値の正本を保持（Calは予約基盤）

技術：Prisma＋SQLite（開発）→ 本番はPostgreSQL

スキーマ最小：bookingUid, nameJa, nameKana?, nameRomaji?, email, phone, start, eventTypeId, status

受け入れ：予約時にDBへ保存、キャンセルでstatus更新、一覧はDBから表示

M5: コンテンツ＆SEO（信頼と集客）

ページ：ホーム／メニュー料金／施術の流れ／Before-After／スタッフ紹介／アクセス（地図/駐車）／FAQ／ポリシー（キャンセル/遅刻）／お知らせ

SEO基礎：タイトル/ディスクリプション、HairSalon の構造化データ、営業時間、NAP整合、OGP画像

受け入れ：Core Web Vitals良好、検索で店名＋地域で上位に（継続改善）

M6: 通知とノーショー対策

予約直後の確認メール（またはCal側のメールを利用）

前日/当日リマインド（メール or SMS）

受け入れ：キャンセル率/ノーショー率が基準内に（運用で調整）

技術スタックと設計のコア指針

Next.js (App Router)：公開ページは基本SSG/ISR、予約APIはRoute Handlers（Nodeランタイム）

Cal API v2：/slots / /slots/reservations / /bookings / /bookings/{uid}/cancel

バージョンヘッダ固定（将来の破壊的変更に備える）

入力バリデ：サーバー側必須（メール書式/必須/過去時刻/スロット整合）

エラー設計：

400（入力不備）、409（スロット競合/古い表示）、502（外部呼び出し失敗）、500（未知）

フロントは 409 をハンドル→「空き枠を更新」自動実行

文字化け対策：

すべて application/json; charset=utf-8

クライアント送信はUTF-8バイト（運用はブラウザなのでOK／スクリプト時のみ注意）

アクセシビリティ：

16px以上、十分なコントラスト、キーボード操作、エラーはaria-live

パフォーマンス：

画像はnext/image、CSSはTailwind、公開ページは静的化、予約ページは必要最低限のJS

セキュリティ：

.env秘匿、Webhook署名検証、Rate Limit（/bookingsにIP/セッションでスロットリング）、reCAPTCHA/hCaptcha（必要時）

運用：

ログは構造化（入力/外部呼出/HTTPコード/uid/start）

監視：Sentry など（後で）

UX仕様（高齢層向けのディテール）

1操作=1画面、次へ/戻る固定配置、進捗（1/4 → 4/4）

大きなボタン／タップ領域、余白多め、専門用語を避ける

入力は候補を出す（電話番号フォーマット、メール候補）

エラーは大きく・日本語で・その場で

完了画面に「地図」「持ち物」「所要時間」の再掲

リスク＆対策

スロットのズレ：ガード＆409→即リロード（実装済み）

Cal API変更：cal-api-version固定、週1で疎通チェック

メール到達：可能なら独自ドメイン＋SPF/DKIM、Calのデフォ通知に寄せる

人手運用：紙出力の当日一覧、電話予約の手動入力手順も用意

“次にやること”チェックリスト（すぐ動ける順）

UI接続：date画面→/api/cal/slots、info→ confirm→/api/cal/bookings

409時のUI：トースト表示＋空き枠自動再取得

Webhook：署名検証→イベント別ログ（キャンセル/変更が拾えてるか）

管理ミニページ：今日の予約一覧（DB導入後はDB由来で）

コンテンツ雛形：ホーム/メニュー/アクセス/ポリシーだけ先に公開